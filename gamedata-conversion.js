// Data kindly lifted from https://strategywiki.org/wiki/Freshly-Picked_Tingle%27s_Rosy_Rupeeland/Best_prices

let rawJ = `{"tbody":[{"tr":[{"td":["Guard","Allow entry to Port Town","5"]},{"td":["Guard",{"i":"'Welcome'","#text":"Talk:"},"5"]},{"td":["Guard",{"i":"'Empty Jar","#text":"Offer:"},"149"]},{"td":["Guard",{"i":"'Empty Jar Memory'","#text":"Offer:"},"218"]},{"td":["Guard",{"i":"'Oinker Revolt'","#text":"Talk:"},"80"]},{"td":["Guard",{"i":"'Empty Jar Day'","#text":"Offer:"},"381"]},{"td":["Guard",{"i":"'Special Empty Jar'","#text":"Offer:"},"754"]},{"td":["Chef","Open his kitchen to Tingle","10"]},{"td":["Chef",{"i":"'Ingredient Tips'","#text":"Talk:"},"10"]},{"td":["Chef",{"i":"'Potato Tips'","#text":"Talk:"},"100"]},{"td":["Chef",{"i":"'Ocean soup'","#text":"Talk:"},"3,000"]},{"td":["Chef",{"i":"'Super Soup'","#text":"Talk:"},"5,000"]},{"td":["Armourer","Open his shop to Tingle","15"]},{"td":["Armourer",{"i":"'Hero Lyphos'","#text":"Talk:"},"20"]},{"td":["Armourer",{"i":"'Jar For Sale!'","#text":"Offer:"},"50"]},{"td":["Armourer",{"i":"'Cape Legend'","#text":"Talk:"},"50"]},{"td":["Jeweller","Open his shop to Tingle","27"]},{"td":["Jeweller",{"i":"'White Sparkle'","#text":"Talk:"},"25"]},{"td":["Bella","Open her caf√© to Tingle","36"]},{"td":["Bella",{"i":"'Full of Freshness'","#text":"Talk:"},"35"]},{"td":["Bella",{"i":"'Simple Juice'","#text":"Talk:"},"150"]},{"td":["Bella",{"i":"'Sweet Fragrance'","#text":"Talk:"},"650"]},{"td":["Bella",{"i":"'Full of Elegance'","#text":"Talk:"},"2,000"]},{"td":["Bella",{"i":"'Last Emperor'","#text":"Talk:"},"5,000"]},{"td":["Chiko's Mum",{"i":"'Fairy'","#text":"Talk:"},"15"]},{"td":["Chiko's Mum",{"i":"'One Love'","#text":"Talk:"},"300"]},{"td":["Chiko's Mum",{"i":"'Endless Love'","#text":"Talk:"},"1,500"]},{"td":["Chiko's Mum","Mend the Worn-Out Rag","1,750"]},{"td":["Chiko's Mum",{"i":"'Family History'","#text":"Talk:"},"850"]},{"td":["Waitress","Purchase the medium cooking pot","500"]},{"td":["Waitress","Purchase the huge cooking pot","1,500"]},{"td":["Hero's Shrine Gate","Allow access to Hero's Shrine","50"]},{"td":["Trick Chest (Hero's Shrine)","Contains 200 Rupees","50"]},{"td":["Teddy Todo","Employ as bodyguard until the Hero's Shrine is cleared","20"]},{"td":["Teddy Todo","Share for helping in the Hero's Shrine","100"]},{"td":["Journalist",{"i":"'Fountain Legend'","#text":"Talk:"},"185"]},{"td":["Fountain","Revive the fountain fairy","20,000"]},{"td":["Old Gent",{"i":"'First Shake'","#text":"Talk:"},"1,501"]},{"td":["Old Gent",{"i":"'Second Shake'","#text":"Talk:"},"1,625"]},{"td":["Old Gent",{"i":"'Third Shake'","#text":"Talk:"},"1,751"]},{"td":["Tingle's Uncle","Purchase the Staff Roll","10,000"]},{"td":["Western Pool","Tower Level 1 + Access to Sunshine Seashore","650"]},{"td":["Western Pool","Tower Level 2 + Access to Cape Treasure","1,650"]},{"td":["Western Pool","Tower Level 3 + Access to Lon Lon Meadow","5,650"]},{"td":["Western Pool","Tower Level 4 + Access to Deku Forest","11,650"]},{"td":["Western Pool","Tower Level 5 + Access to Steamy Marsh","29,650"]},{"td":["Western Pool","Tower Level 6 + Access to Gooey Swamp","56,650"]},{"td":["Western Pool","Tower Level 7 + Access to Icy Plain","110,650"]},{"td":["Western Pool","Tower Level 8 + Access to Mount Desma","191,650"]},{"td":["Western Pool","Tower Level 9 + Access to Fairy Garden","313,150"]},{"td":["Western Pool","Tower Level 10 + Access to Auros Ruins","495,400"]}]},{"tr":[{"td":["Guard","Reward for curing his wife","960"]},{"td":["Guard","Reward for helping him defeat the Icy Plain ghost","20,000"]},{"td":["Chiko's Mum","Reward for returning the Fairy Doll","60"]},{"td":["Jeweller","Reward for finding his daughter","4,000"]},{"td":["Armourer","Best haggle price for a Shoddy Knife","210"]},{"td":["Armourer","Best haggle price for a Shoddy Shield","210"]},{"td":["Armourer","Best haggle price for a Shoddy Lance","230"]},{"td":["Armourer","Best haggle price for a Low-Budget Mace.","480"]},{"td":["Armourer","Best haggle price for a Tough Shield","520"]},{"td":["Armourer","Best haggle price for a Shoulder Spikes","2,900"]},{"td":["Armourer","Best haggle price for a Destructor Axe","3,500"]},{"td":["Armourer","Best haggle price for a Poker Lance","3,500"]},{"td":["Armourer","Best haggle price for a 10-Man Slicer","8,800"]},{"td":["Armourer","Best haggle price for a 999-Man Slicer","15,000"]},{"td":["Armourer","Best haggle price for the Lyphos Sword","96,000"]},{"td":["Chiko's Mum","Best haggle price for a Hand-Sewn Robe","1,750"]},{"td":["Chiko's Mum","Best haggle price for a Magical Hat","9,800"]},{"td":["Chiko's Mum","Reward for letting Chiko see a real fairy","32,000"]},{"td":["Old Gent","Reward for retrieving all three of Paul's belongings","14,000"]}]},{"tr":{"td":["Duke","Repair the bridge between Hometown Prairie and Sunshine Seashore","99"]}},{"tr":[{"td":["Duke","Bridge repair refund","9,999"]},{"td":["Judge","Bridge repair refund","22,222"]},{"td":["Duko","Bridge repair refund","55,555"]}]},{"tr":[{"td":["Duke","Repair the bridge between Sunshine Seashore and Cape Treasure","199"]},{"td":["Salona","Purchase Recipe 9: Treasure Puree (Local Recipe)","1,200"]},{"td":["Pirate Hideaway Gate","Allow access to Pirate Hideaway","500"]},{"td":["Pirate near boat","Explain boat mechanics","30"]},{"td":["Pirate in dormitory","Nothing","20"]}]},{"tr":{"td":["Journalist","Reward for giving him Simple Juice","800"]}},{"tr":[{"td":["Duke","Purchase shovel","750"]},{"td":["Duke","Repair the bridge between Cape Treasure and Lon Lon Meadow","299"]}]},{"tr":[{"td":["Junglo","Bridge the ravine","300"]},{"td":["Junglo","Navigating the Forest Maze (alternatively: up, left, left, up, left, up, right, right, down, right, up, right, up)","721"]},{"td":["Junglo",{"i":"'Sleepless Nights'","#text":"Talk:"},"850"]},{"td":["Junglo",{"i":"'Rippling Muscles'","#text":"Talk:"},"900"]},{"td":["Junglo",{"i":"'Forest Maze'","#text":"Talk:"},"1,900"]},{"td":["Duke","Repair the bridge between Lon Lon Meadow and Deku Forest","699"]},{"td":["Great Deku Tree","Open Deku Temple (Rupees are stored in Green Chest in Deku Temple)","1"]},{"td":["Deku Temple Gate","Allow access to Deku Temple","1,500"]},{"td":["Trick Chest (Deku Temple)","Contains 3 Ancient Coins (which sell for 50 each, causing a net loss)","200"]}]},{"tr":[{"td":["Journalist","Reward for giving him Sweet Juice","1,600"]},{"td":["Junglo","Reward for escorting him home","2,000"]},{"td":["Junglo","Reward for reuniting Aba and the Armourer","7,800"]},{"td":["Great Deku Tree","Reward for healing the Deku Sprout","6,000"]}]},{"tr":[{"td":["Queen Bee","Ride to Insect Hive in Gooey Swamp","500"]},{"td":["Salona","Purchase an Empty Jar","750"]}]},{"tr":{"td":["Queen Bee","Reward for eliminating the fog","12,000"]}},{"tr":[{"td":["Explorer Secretary","Purchase an Empty Jar","1,000"]},{"td":["Explorer Medic","Recipe #17: Tinglene","2,000"]},{"td":["Expedition Member with Fan","Information on butterfly locations ('something good')","250"]},{"td":["Salona",{"i":"'UFO'","#text":"Talk:"},"1,000"]},{"td":["Judge","Repair bridge to Golden Obelisk","1,500"]},{"td":["Judge","Repair Gooey Swamp-to-Steamy Marsh bridge","1,222"]},{"td":["Insect Cavern Gate","Allow access to Insect Cavern","3,000"]},{"td":["Teddy Todo","Share for helping in the Insect Cavern","1,500"]}]},{"tr":[{"td":["Journalist","Reward for giving him Queen Juice","5,000"]},{"td":["Naked Salona","Reward for returning Green Hood","8,000"]}]},{"tr":[{"td":["Judge","Repair Icy Plain-to-Gooey Swamp bridge","2,222"]},{"td":["Chiko's Grandmother","Revive the fallen Guard.","1,000"]}]},{"tr":{"td":["Old Gent","Reward for returning all five airship pieces","22,000"]}},{"tr":[{"td":["Male Yamatami villager","To be greeted (before clearing Desma's Labyrinth)","50"]},{"td":["Sleeping Yamatami villager","Listen to snoring (before clearing Desma's Labyrinth)","50"]},{"td":["Yamatami elder","Talk about sacred flames (before clearing Desma's Labyrinth)","50"]},{"td":["Yamatami bard","Hear a song (before clearing Desma's Labyrinth)","200"]},{"td":["Female Yamatami villager","To access Rocky Orb (before clearing Desma's Labyrinth)","400"]},{"td":["Yamatami meat merchant","Purchase Minced Meat (before clearing Desma's Labyrinth)","150"]},{"td":["Yamatami meat merchant","Purchase Minced Meat (after clearing Desma's Labyrinth)","10"]},{"td":["Yamatami vegetable merchant","Purchase Crisp Tomato (before clearing Desma's Labyrinth)","150"]},{"td":["Yamatami vegetable merchant","Purchase Crisp Tomato (after clearing Desma's Labyrinth)","10"]},{"td":["Yamatami fish merchant","Purchase Love Carp (before clearing Desma's Labyrinth)","150"]},{"td":["Yamatami fish merchant","Purchase Love Carp (after clearing Desma's Labyrinth)","10"]},{"td":["Yamatami farmer","To access Super Sweetcorn vines","150"]},{"td":["Yamatami herder","To access rabbit pen","500"]},{"td":["Yamatami mother","Purchase Recipe 28: Desma Syrup","16,000"]},{"td":["King","Heal the king","7,500"]},{"td":["Desma's Labyrinth Gate","Allow access to Desma's Labyrinth","8,000"]}]},{"tr":[{"td":["Journalist","Bring Emperor Juice","10,000"]},{"td":["King","Reward for defeating Fire Monster Dora Dora","30,000"]},{"td":["King","Haggle price for 1 Nidorian","170"]}]},{"tr":{"td":["Duko","Repair Fairy Garden-to-Mount Desma bridge","5,555"]}},{"tr":[{"td":["Grand Fairy","Reward for restoring her fountain","65,000"]},{"td":["Grand Fairy","Return the Make-Up Mirror","70,000"]}]},{"tr":{"td":["Duko","Repair Auros Ruins-to-Fairy Garden bridge","15,555"]}},{"tr":{"td":["Oinker Lovers","Return the Oinker Tiara","30,000"]}}]}`;

    rawJS = JSON.parse(rawJ);

    let tmpNPC = {}, loc_d="", xj=0;
    offerArr = [0,2,4,6,7,9,11,13,15,17,19];
    newPlace = [2,4,6,7,9,11,13,15,17,19];

    let lv2JL = rawJS["tbody"].length;
    for(var j=0;j<lv2JL;j++){

      if(newPlace.includes(j)) xj++;
      if(!tmpNPC.hasOwnProperty("loc_"+xj)) tmpNPC["loc_"+xj] = {};

      loc_d = offerArr.includes(j) ? "Offer" : "Ask";

      let lv1JL = rawJS["tbody"][j]["tr"].length;

      let npcsIx;
      if(lv1JL===undefined){
        npcIx = rawJS["tbody"][j]["tr"]["td"];
        innerNPC_F();
      }else{
        for(var i=0;i<lv1JL;i++){
          npcsIx = rawJS["tbody"][j]["tr"][i]["td"]; // eine NPC-Zeile [NPC,Request(l=1 oder l=2),Preis]
          innerNPC_F();
        }
        function innerNPC_F(){
          if(!tmpNPC["loc_"+xj].hasOwnProperty(npcsIx[0])) tmpNPC["loc_"+xj][npcsIx[0]] = [];

          if(npcsIx[1],npcsIx[1].length===undefined){
            tmpNPC["loc_"+xj][npcsIx[0]].push({"req":npcsIx[1]['i'],"price":parseInt(npcsIx[2].replace(/,/g,'')),"dirc":loc_d,"tag":npcsIx[1]['#text'] });
          }else{
            tmpNPC["loc_"+xj][npcsIx[0]].push({"req":npcsIx[1],"price":parseInt(npcsIx[2].replace(/,/g,'')),"dirc":loc_d });
          }
        }
      }

    }

    console.log(tmpNPC);
